<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Constructor de Frases Retro</title>
    <!-- Importem una font estil p√≠xel per a la interf√≠cie i una molt llegible per a les paraules -->
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Verdana:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CONFIGURACI√ì GENERAL --- */
        :root {
            --cel: #5c94fc;
            --gespa: #80d010;
            --terra: #c84c0c;
            --totxana: #e75a10;
            --blanc: #ffffff;
            --ombra: rgba(0, 0, 0, 0.4);
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--cel);
            font-family: 'Verdana', sans-serif; /* Lletra clara per als nens */
            overflow: hidden; /* Evitem scroll */
            touch-action: none; /* Millora per a dispositius t√†ctils */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            user-select: none;
        }

        /* --- FONS I ELEMENTS DECORATIUS --- */
        .fons {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .nuvol {
            position: absolute;
            background: #fff;
            border-radius: 20px;
            opacity: 0.8;
            /* Forma pixelada simulada amb box-shadows */
        }

        .terra {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 60px;
            background-color: var(--gespa);
            border-top: 4px solid #5ea208;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.05) 10px, rgba(0,0,0,0.05) 20px);
        }

        /* --- INTERF√çCIE D'USUARI --- */
        #contenidor-joc {
            width: 95%;
            max-width: 900px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            font-family: 'VT323', monospace;
            font-size: 2rem;
            color: white;
            text-shadow: 2px 2px 0 #000;
        }

        .info-btn {
            background: #fff;
            color: var(--cel);
            border: 2px solid #000;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-family: 'Verdana', sans-serif;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 2px 2px 0 #000;
        }

        /* --- ZONA DE JOC --- */
        .zona-frase {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 30px;
        }

        .instruccio {
            font-family: 'VT323', monospace;
            font-size: 1.5rem;
            color: white;
            text-shadow: 1px 1px 0 #000;
            margin-bottom: 10px;
        }

        /* Contenidor on deixem les paraules (Zona superior) */
        .zona-objectiu {
            min-height: 80px;
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            border: 2px dashed rgba(255, 255, 255, 0.5);
        }

        /* Contenidor de les paraules barrejades (Zona inferior) */
        .zona-banc {
            min-height: 80px;
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            padding: 10px;
        }

        /* --- ESTIL DE LES PARAULES (BLOQUE RETRO) --- */
        .paraula {
            background-color: var(--totxana);
            color: white;
            padding: 10px 20px;
            font-size: 1.5rem; /* Mida 24px m√≠nim */
            font-weight: bold;
            cursor: grab;
            border-top: 4px solid #ff8e5e;
            border-left: 4px solid #ff8e5e;
            border-right: 4px solid #a83600;
            border-bottom: 4px solid #a83600;
            box-shadow: 3px 3px 5px var(--ombra);
            border-radius: 4px;
            transition: transform 0.1s;
            touch-action: none; /* Vital per al drag en m√≤bils */
        }

        .paraula:active {
            cursor: grabbing;
            transform: scale(1.05);
        }

        .paraula.correcte {
            background-color: var(--gespa);
            border-top-color: #a4f22e;
            border-left-color: #a4f22e;
            border-right-color: #4b7a08;
            border-bottom-color: #4b7a08;
            animation: saltet 0.4s ease-in-out;
        }

        /* --- ANIMACIONS --- */
        @keyframes saltet {
            0% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0); }
        }

        .particula {
            position: absolute;
            width: 8px;
            height: 8px;
            background: gold;
            pointer-events: none;
            box-shadow: 0 0 4px gold;
        }

        /* --- FINESTRES MODALS (INFO i FINAL) --- */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .caixa-missatge {
            background: white;
            padding: 30px;
            border: 4px solid black;
            max-width: 500px;
            width: 80%;
            text-align: center;
            box-shadow: 10px 10px 0 rgba(0,0,0,0.5);
            font-family: 'Verdana', sans-serif;
            position: relative;
        }

        .titol-retro {
            font-family: 'VT323', monospace;
            font-size: 3rem;
            color: var(--terra);
            margin: 0 0 20px 0;
        }

        .text-info {
            text-align: left;
            line-height: 1.5;
            font-size: 1rem;
        }

        .boto-retro {
            background: var(--gespa);
            border: 2px solid black;
            color: white;
            font-family: 'VT323', monospace;
            font-size: 1.8rem;
            padding: 10px 30px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 4px 4px 0 black;
            transition: transform 0.1s;
        }

        .boto-retro:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 black;
        }

        .boto-tancar {
            position: absolute;
            top: 10px;
            right: 10px;
            background: red;
            color: white;
            border: 2px solid black;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-weight: bold;
        }

    </style>
</head>
<body>

    <!-- Fons decoratiu -->
    <div class="fons">
        <!-- N√∫vols fets amb SVG inline per rendiment -->
        <svg width="100%" height="100%">
            <rect x="10%" y="10%" width="100" height="40" rx="10" fill="white" opacity="0.6"/>
            <rect x="70%" y="20%" width="120" height="50" rx="10" fill="white" opacity="0.7"/>
            <rect x="40%" y="40%" width="80" height="30" rx="10" fill="white" opacity="0.5"/>
        </svg>
    </div>
    <div class="terra"></div>

    <div id="contenidor-joc">
        <header>
            <div id="nivell-text">NIVELL 1</div>
            <div id="progres">0 / 9</div>
            <button class="info-btn" onclick="mostrarInfo()">‚ÑπÔ∏è</button>
        </header>

        <div class="zona-frase">
            <div class="instruccio">Arrossega per ordenar la frase:</div>
            
            <!-- Aqu√≠ deixem les paraules -->
            <div id="zona-drop" class="zona-objectiu"></div>
            
            <!-- Aqu√≠ apareixen les paraules barrejades -->
            <div id="zona-drag" class="zona-banc"></div>
        </div>

        <div style="height: 60px;"></div> <!-- Espaiador per al terra -->
    </div>

    <!-- MODAL D'INFORMACI√ì PEDAG√íGICA -->
    <div id="modal-info" class="modal">
        <div class="caixa-missatge">
            <button class="boto-tancar" onclick="tancarModals()">X</button>
            <h2 class="titol-retro">Informaci√≥ Pedag√≤gica</h2>
            <div class="text-info">
                <p><strong>Objectiu:</strong> Consci√®ncia sint√†ctica (ordenar estructures gramaticals).</p>
                <p><strong>DUA (Disseny Universal per a l'Aprenentatge):</strong></p>
                <ul>
                    <li>Suport visual (colors i formes clares).</li>
                    <li>Sense pressi√≥ de temps (ritme propi).</li>
                    <li>Refor√ß positiu immediat (so i animaci√≥).</li>
                    <li>Tipografia accessible (sans-serif gran).</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- PANTALLA FINAL -->
    <div id="modal-final" class="modal">
        <div class="caixa-missatge">
            <h1 class="titol-retro" style="color: gold; text-shadow: 2px 2px 0 black;">ETS INSUPERABLE! üåü</h1>
            <p style="font-size: 1.2rem;">Has completat tots els nivells.</p>
            <button class="boto-retro" onclick="reiniciarJoc()">NOU REPTE?</button>
        </div>
    </div>

    <script>
        /* * ==========================================
         * BANC DE DADES I CONFIGURACI√ì
         * ==========================================
         */
        
        const FRASES_DADES = {
            nivell1: [
                "La mare menja", "El sol surt", "El gat dorm", "En Pau juga", "La lluna brilla",
                "El gos corre", "Jo tinc gana", "El pa √©s bo", "La flor creix", "L'aigua cau"
            ],
            nivell2: [
                "La nena menja poma", "El cotxe √©s vermell", "L'avi t√© un gat", "Anem a la platja",
                "La pilota cau ara", "El peix nada r√†pid", "M'agrada llegir contes", "La pluja mulla tot",
                "El nen beu llet", "La sargantana puja r√†pid"
            ],
            nivell3: [
                "El gos gran corre pel bosc", "La germana balla molt b√© avui", "Ahir vam anar a la masia",
                "El mestre explica un conte bonic", "Les flors del jard√≠ fan olor", "El past√≠s de xocolata √©s dol√ß",
                "M'agrada jugar amb els amics", "El sol brilla dalt del cel", "Els ocells volen pels n√∫vols",
                "La Maria menja un bon entrep√†"
            ]
        };

        let estatJoc = {
            frasesSeleccionades: [], // Array amb les 9 frases de la partida (3 de cada nivell)
            indexActual: 0,          // Quina frase estem jugant (0-8)
            fraseActualObj: null,    // Objecte amb la frase i l'ordre correcte
            encerts: 0
        };

        // Elements DOM principals
        const elZonaDrag = document.getElementById('zona-drag');
        const elZonaDrop = document.getElementById('zona-drop');
        const elNivellTxt = document.getElementById('nivell-text');
        const elProgresTxt = document.getElementById('progres');
        const elModalFinal = document.getElementById('modal-final');
        const elModalInfo = document.getElementById('modal-info');

        /* * ==========================================
         * MOTOR D'√ÄUDIO (Web Audio API)
         * Genera sons sense fitxers externs
         * ==========================================
         */
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function tocarSo(tipus) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (tipus === 'bling') {
                // So "Moneda" (Ona quadrada, pitch alt i curt)
                osc.type = 'square';
                osc.frequency.setValueAtTime(987, audioCtx.currentTime); // B5
                osc.frequency.exponentialRampToValueAtTime(1318, audioCtx.currentTime + 0.1); // E6
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            } else if (tipus === 'error') {
                // So d'error suau
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.2);
            } else if (tipus === 'fanfarrria') {
                // Seq√º√®ncia de vict√≤ria simple
                const notes = [523.25, 659.25, 783.99, 1046.50]; // C, E, G, C
                let start = audioCtx.currentTime;
                notes.forEach((freq, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.type = 'square';
                    o.frequency.value = freq;
                    o.connect(g);
                    g.connect(audioCtx.destination);
                    g.gain.setValueAtTime(0.2, start + i*0.1);
                    g.gain.exponentialRampToValueAtTime(0.01, start + i*0.1 + 0.3);
                    o.start(start + i*0.1);
                    o.stop(start + i*0.1 + 0.3);
                });
            }
        }

        /* * ==========================================
         * L√íGICA DEL JOC
         * ==========================================
         */

        function iniciarJoc() {
            // 1. Reiniciar estat
            estatJoc.indexActual = 0;
            estatJoc.encerts = 0;
            tancarModals();

            // 2. Seleccionar 3 frases aleat√≤ries de cada nivell
            const nivell1 = barrejarArray([...FRASES_DADES.nivell1]).slice(0, 3);
            const nivell2 = barrejarArray([...FRASES_DADES.nivell2]).slice(0, 3);
            const nivell3 = barrejarArray([...FRASES_DADES.nivell3]).slice(0, 3);
            
            estatJoc.frasesSeleccionades = [...nivell1, ...nivell2, ...nivell3];

            carregarNivell();
        }

        function carregarNivell() {
            // Actualitzar UI Header
            const index = estatJoc.indexActual;
            let nivellActual = 1;
            if (index >= 3) nivellActual = 2;
            if (index >= 6) nivellActual = 3;

            elNivellTxt.innerText = `NIVELL ${nivellActual}`;
            elProgresTxt.innerText = `${index} / 9`;

            // Si hem acabat
            if (index >= 9) {
                tocarSo('fanfarrria');
                mostrarFinal();
                return;
            }

            // Preparar Frase
            const fraseString = estatJoc.frasesSeleccionades[index];
            // Dividim per espais per obtenir paraules
            const paraulesCorrectes = fraseString.split(" ");
            
            // Barregem per mostrar al banc
            let paraulesBarrejades = barrejarArray([...paraulesCorrectes].map((txt, i) => ({
                id: i,
                text: txt
            })));

            // Netejar zones
            elZonaDrag.innerHTML = '';
            elZonaDrop.innerHTML = '';

            // Crear elements DOM per a les paraules
            paraulesBarrejades.forEach(p => {
                const div = crearElementParaula(p.text, p.id);
                elZonaDrag.appendChild(div);
            });
        }

        function crearElementParaula(text, idOriginal) {
            const div = document.createElement('div');
            div.classList.add('paraula');
            div.innerText = text;
            div.dataset.id = idOriginal; // Guardem l'√≠ndex original per comprovar l'ordre
            div.draggable = true;
            
            // Events Drag & Drop (Escriptori)
            div.addEventListener('dragstart', dragStart);
            
            // Events Touch (M√≤bil) - L√≤gica customitzada
            div.addEventListener('touchstart', touchStart, {passive: false});
            div.addEventListener('touchmove', touchMove, {passive: false});
            div.addEventListener('touchend', touchEnd);

            return div;
        }

        /* * ==========================================
         * DRAG & DROP (H√çBRID MOUSE/TOUCH)
         * ==========================================
         */
        
        let elementArrossegat = null;
        let touchOffset = { x: 0, y: 0 };
        let elementClonat = null; // Per visualitzar el drag en touch

        // --- Mouse Events ---
        function dragStart(e) {
            elementArrossegat = e.target;
            e.dataTransfer.effectAllowed = 'move';
            // Petit hack per amagar l'element original mentre s'arrossega si es vol, 
            // per√≤ en estil retro queda b√© veure'l.
            setTimeout(() => e.target.style.opacity = '0.5', 0);
        }

        // Zona Drop Events
        [elZonaDrop, elZonaDrag].forEach(zona => {
            zona.addEventListener('dragover', (e) => {
                e.preventDefault(); // Necessari per permetre drop
            });
            zona.addEventListener('dragenter', (e) => e.preventDefault());
            zona.addEventListener('drop', (e) => dropLogic(e, zona));
        });

        // Restaurar opacitat en acabar drag
        document.addEventListener('dragend', (e) => {
            if(e.target.classList.contains('paraula')) {
                e.target.style.opacity = '1';
            }
        });

        function dropLogic(e, zonaDesti) {
            e.preventDefault();
            if (!elementArrossegat) return;

            // Movem l'element al nou contenidor
            zonaDesti.appendChild(elementArrossegat);
            elementArrossegat.style.opacity = '1';
            
            // Comprovar si la frase est√† completa i correcta
            verificarEstat();
        }

        // --- Touch Events (M√©s complex per suportar D&D fluid) ---
        function touchStart(e) {
            e.preventDefault(); // Evitar scroll
            const touch = e.touches[0];
            const target = e.target;
            
            elementArrossegat = target;
            
            // Calculem offset per agafar la pe√ßa pel lloc on s'ha tocat
            const rect = target.getBoundingClientRect();
            touchOffset.x = touch.clientX - rect.left;
            touchOffset.y = touch.clientY - rect.top;

            // Creem un clon visual per moure pel dit
            elementClonat = target.cloneNode(true);
            elementClonat.style.position = 'fixed';
            elementClonat.style.zIndex = '1000';
            elementClonat.style.opacity = '0.8';
            elementClonat.style.width = rect.width + 'px';
            elementClonat.style.pointerEvents = 'none'; // Per poder detectar elements sota
            
            document.body.appendChild(elementClonat);
            moureClon(touch.clientX, touch.clientY);
            
            target.style.opacity = '0.3';
        }

        function touchMove(e) {
            e.preventDefault();
            if (!elementClonat) return;
            const touch = e.touches[0];
            moureClon(touch.clientX, touch.clientY);
        }

        function touchEnd(e) {
            if (!elementClonat) return;
            const touch = e.changedTouches[0];
            
            // Detectar on hem deixat anar
            // Hem d'amagar el clon un moment per fer elementFromPoint
            elementClonat.style.display = 'none';
            let elementSota = document.elementFromPoint(touch.clientX, touch.clientY);
            
            // Busquem si hem deixat anar sobre una zona v√†lida
            let zonaDesti = elementSota ? elementSota.closest('.zona-objectiu, .zona-banc') : null;

            if (zonaDesti && elementArrossegat) {
                zonaDesti.appendChild(elementArrossegat);
            }

            // Neteja
            document.body.removeChild(elementClonat);
            elementClonat = null;
            if(elementArrossegat) elementArrossegat.style.opacity = '1';
            elementArrossegat = null;

            verificarEstat();
        }

        function moureClon(x, y) {
            elementClonat.style.left = (x - touchOffset.x) + 'px';
            elementClonat.style.top = (y - touchOffset.y) + 'px';
        }

        /* * ==========================================
         * VERIFICACI√ì I FEEDBACK
         * ==========================================
         */

        function verificarEstat() {
            // Nom√©s verifiquem si totes les paraules s√≥n a la zona objectiu
            // comptem paraules totals de la frase actual
            const totalParaules = estatJoc.frasesSeleccionades[estatJoc.indexActual].split(" ").length;
            const paraulesColocades = elZonaDrop.children;

            if (paraulesColocades.length === totalParaules) {
                // Comprovem l'ordre
                let correcte = true;
                for (let i = 0; i < paraulesColocades.length; i++) {
                    // L'ID 0 √©s la primera paraula, 1 la segona...
                    if (parseInt(paraulesColocades[i].dataset.id) !== i) {
                        correcte = false;
                        break;
                    }
                }

                if (correcte) {
                    animacioExit();
                } else {
                    // Feedback visual d'error (opcional, aqu√≠ nom√©s no fa res fins que estigui b√©)
                    // Podem fer un petit so d'error si es vol
                    tocarSo('error');
                }
            }
        }

        function animacioExit() {
            // 1. Canviar estil visual
            const paraules = document.querySelectorAll('#zona-drop .paraula');
            paraules.forEach(p => {
                p.classList.add('correcte');
                crearParticules(p);
            });

            // 2. So
            tocarSo('bling');

            // 3. Esperar i passar nivell
            setTimeout(() => {
                estatJoc.indexActual++;
                carregarNivell();
            }, 1500);
        }

        function crearParticules(element) {
            const rect = element.getBoundingClientRect();
            const centreX = rect.left + rect.width / 2;
            const centreY = rect.top + rect.height / 2;

            for (let i = 0; i < 10; i++) {
                const part = document.createElement('div');
                part.classList.add('particula');
                document.body.appendChild(part);

                // Posici√≥ inicial
                part.style.left = centreX + 'px';
                part.style.top = centreY + 'px';

                // Animaci√≥ simple amb JS
                const angle = Math.random() * Math.PI * 2;
                const velocitat = Math.random() * 50 + 20; // P√≠xels de dist√†ncia
                const destX = Math.cos(angle) * velocitat;
                const destY = Math.sin(angle) * velocitat;

                part.animate([
                    { transform: `translate(0,0) scale(1)`, opacity: 1 },
                    { transform: `translate(${destX}px, ${destY}px) scale(0)`, opacity: 0 }
                ], {
                    duration: 600,
                    easing: 'ease-out'
                }).onfinish = () => part.remove();
            }
        }

        /* * ==========================================
         * UTILITATS I GESTI√ì UI
         * ==========================================
         */

        function barrejarArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function mostrarInfo() {
            elModalInfo.style.display = 'flex';
        }

        function mostrarFinal() {
            elModalFinal.style.display = 'flex';
        }

        function tancarModals() {
            elModalInfo.style.display = 'none';
            elModalFinal.style.display = 'none';
        }

        function reiniciarJoc() {
            tancarModals();
            iniciarJoc();
        }

        // --- INICIALITZACI√ì ---
        window.onload = iniciarJoc;

    </script>
</body>
</html>